{"/mnt/c/Users/migue/Documents/U/3ero/DSI/p10/src/Client/NotesManagerClient.ts":{"path":"/mnt/c/Users/migue/Documents/U/3ero/DSI/p10/src/Client/NotesManagerClient.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":36}},"2":{"start":{"line":4,"column":17},"end":{"line":4,"column":34}},"3":{"start":{"line":5,"column":16},"end":{"line":5,"column":34}},"4":{"start":{"line":6,"column":18},"end":{"line":6,"column":39}},"5":{"start":{"line":16,"column":8},"end":{"line":16,"column":16}},"6":{"start":{"line":17,"column":8},"end":{"line":17,"column":41}},"7":{"start":{"line":21,"column":8},"end":{"line":23,"column":11}},"8":{"start":{"line":22,"column":12},"end":{"line":22,"column":43}},"9":{"start":{"line":27,"column":8},"end":{"line":29,"column":11}},"10":{"start":{"line":28,"column":12},"end":{"line":28,"column":30}},"11":{"start":{"line":33,"column":8},"end":{"line":35,"column":11}},"12":{"start":{"line":34,"column":12},"end":{"line":34,"column":50}},"13":{"start":{"line":36,"column":8},"end":{"line":36,"column":50}},"14":{"start":{"line":39,"column":8},"end":{"line":39,"column":40}},"15":{"start":{"line":40,"column":8},"end":{"line":40,"column":42}},"16":{"start":{"line":47,"column":8},"end":{"line":50,"column":11}},"17":{"start":{"line":48,"column":12},"end":{"line":48,"column":83}},"18":{"start":{"line":49,"column":12},"end":{"line":49,"column":29}},"19":{"start":{"line":52,"column":31},"end":{"line":52,"column":33}},"20":{"start":{"line":53,"column":8},"end":{"line":59,"column":11}},"21":{"start":{"line":54,"column":12},"end":{"line":54,"column":38}},"22":{"start":{"line":55,"column":12},"end":{"line":58,"column":13}},"23":{"start":{"line":56,"column":16},"end":{"line":56,"column":68}},"24":{"start":{"line":57,"column":16},"end":{"line":57,"column":38}},"25":{"start":{"line":69,"column":33},"end":{"line":69,"column":62}},"26":{"start":{"line":70,"column":8},"end":{"line":74,"column":9}},"27":{"start":{"line":71,"column":24},"end":{"line":71,"column":65}},"28":{"start":{"line":72,"column":12},"end":{"line":72,"column":65}},"29":{"start":{"line":73,"column":12},"end":{"line":73,"column":39}},"30":{"start":{"line":75,"column":8},"end":{"line":75,"column":68}},"31":{"start":{"line":78,"column":0},"end":{"line":78,"column":48}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":15,"column":4},"end":{"line":15,"column":5}},"loc":{"start":{"line":15,"column":37},"end":{"line":37,"column":5}},"line":15},"1":{"name":"(anonymous_1)","decl":{"start":{"line":21,"column":31},"end":{"line":21,"column":32}},"loc":{"start":{"line":21,"column":40},"end":{"line":23,"column":9}},"line":21},"2":{"name":"(anonymous_2)","decl":{"start":{"line":27,"column":28},"end":{"line":27,"column":29}},"loc":{"start":{"line":27,"column":34},"end":{"line":29,"column":9}},"line":27},"3":{"name":"(anonymous_3)","decl":{"start":{"line":33,"column":33},"end":{"line":33,"column":34}},"loc":{"start":{"line":33,"column":39},"end":{"line":35,"column":9}},"line":33},"4":{"name":"(anonymous_4)","decl":{"start":{"line":38,"column":4},"end":{"line":38,"column":5}},"loc":{"start":{"line":38,"column":27},"end":{"line":41,"column":5}},"line":38},"5":{"name":"(anonymous_5)","decl":{"start":{"line":45,"column":4},"end":{"line":45,"column":5}},"loc":{"start":{"line":45,"column":28},"end":{"line":60,"column":5}},"line":45},"6":{"name":"(anonymous_6)","decl":{"start":{"line":47,"column":31},"end":{"line":47,"column":32}},"loc":{"start":{"line":47,"column":40},"end":{"line":50,"column":9}},"line":47},"7":{"name":"(anonymous_7)","decl":{"start":{"line":53,"column":30},"end":{"line":53,"column":31}},"loc":{"start":{"line":53,"column":41},"end":{"line":59,"column":9}},"line":53},"8":{"name":"(anonymous_8)","decl":{"start":{"line":68,"column":4},"end":{"line":68,"column":5}},"loc":{"start":{"line":68,"column":62},"end":{"line":76,"column":5}},"line":68}},"branchMap":{"0":{"loc":{"start":{"line":15,"column":16},"end":{"line":15,"column":35}},"type":"default-arg","locations":[{"start":{"line":15,"column":31},"end":{"line":15,"column":35}}],"line":15},"1":{"loc":{"start":{"line":55,"column":12},"end":{"line":58,"column":13}},"type":"if","locations":[{"start":{"line":55,"column":12},"end":{"line":58,"column":13}},{"start":{"line":55,"column":12},"end":{"line":58,"column":13}}],"line":55},"2":{"loc":{"start":{"line":68,"column":28},"end":{"line":68,"column":60}},"type":"default-arg","locations":[{"start":{"line":68,"column":35},"end":{"line":68,"column":60}}],"line":68},"3":{"loc":{"start":{"line":72,"column":21},"end":{"line":72,"column":64}},"type":"cond-expr","locations":[{"start":{"line":72,"column":55},"end":{"line":72,"column":59}},{"start":{"line":72,"column":62},"end":{"line":72,"column":64}}],"line":72},"4":{"loc":{"start":{"line":75,"column":8},"end":{"line":75,"column":67}},"type":"cond-expr","locations":[{"start":{"line":75,"column":31},"end":{"line":75,"column":60}},{"start":{"line":75,"column":63},"end":{"line":75,"column":67}}],"line":75}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":3,"6":3,"7":3,"8":2,"9":3,"10":1,"11":3,"12":2,"13":3,"14":6,"15":6,"16":6,"17":0,"18":0,"19":6,"20":6,"21":3,"22":3,"23":1,"24":1,"25":2,"26":2,"27":2,"28":2,"29":2,"30":2,"31":1},"f":{"0":3,"1":2,"2":1,"3":2,"4":6,"5":6,"6":0,"7":3,"8":2},"b":{"0":[1],"1":[1,2],"2":[0],"3":[2,0],"4":[2,0]},"inputSourceMap":{"version":3,"file":"/mnt/c/Users/migue/Documents/U/3ero/DSI/p10/src/Client/NotesManagerClient.ts","sources":["/mnt/c/Users/migue/Documents/U/3ero/DSI/p10/src/Client/NotesManagerClient.ts"],"names":[],"mappings":";;;AACA,mCAAsC;AAEtC,mCAAgC;AAChC,wCAAkC;AAgBlC;;GAEG;AACH,MAAa,kBAAmB,SAAQ,qBAAY;IAGlD;;;OAGG;IACH,YAAY,eAAuB,IAAI;QACrC,KAAK,EAAE,CAAC;QACR,IAAI,CAAC,KAAK,GAAG,IAAI,aAAK,EAAE,CAAC;QAEzB;;WAEG;QACH,IAAI,CAAC,EAAE,CAAC,aAAa,EAAE,CAAC,GAAG,EAAE,EAAE;YAC7B,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,YAAY,CAAC,CAAC;QACjC,CAAC,CAAC,CAAA;QAEF;;WAEG;QACH,IAAI,CAAC,EAAE,CAAC,UAAU,EAAE,GAAG,EAAE;YACvB,IAAI,CAAC,KAAK,CAAC,IAAI,EAAE,CAAC;QACpB,CAAC,CAAC,CAAC;QAEH;;WAEG;QACH,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,SAAS,EAAE,GAAG,EAAE;YAC5B,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE,IAAI,CAAC,UAAU,CAAC,CAAC;QACxC,CAAC,CAAC,CAAA;QAEF,IAAI,CAAC,OAAO,CAAC,IAAI,qBAAY,EAAE,CAAC,CAAC;IACnC,CAAC;IAGD,OAAO,CAAC,aAA2B;QACjC,IAAI,CAAC,UAAU,GAAG,aAAa,CAAC;QAChC,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;IACpC,CAAC;IAED;;OAEG;IACH,WAAW,CAAC,UAAwB;QAClC,gBAAgB;QAChB,UAAU,CAAC,EAAE,CAAC,OAAO,EAAE,CAAC,GAAG,EAAE,EAAE;YAC7B,OAAO,CAAC,GAAG,CAAC,cAAI,CAAC,4BAA4B,GAAG,CAAC,OAAO,EAAE,CAAC,CAAC,CAAC;YAC7D,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC;QACnB,CAAC,CAAC,CAAC;QAEH,qFAAqF;QACrF,IAAI,gBAAgB,GAAG,EAAE,CAAC;QAC1B,UAAU,CAAC,EAAE,CAAC,MAAM,EAAE,CAAC,KAAK,EAAE,EAAE;YAC9B,gBAAgB,IAAI,KAAK,CAAC;YAE1B,IAAI,gBAAgB,CAAC,gBAAgB,CAAC,MAAM,GAAG,CAAC,CAAC,KAAK,IAAI,EAAE;gBAC1D,IAAI,CAAC,IAAI,CAAC,UAAU,EAAE,IAAI,CAAC,KAAK,CAAC,gBAAgB,CAAC,CAAC,CAAC;gBACpD,gBAAgB,GAAG,EAAE,CAAC;aACvB;QACH,CAAC,CAAC,CAAC;IAEL,CAAC;IAED;;;;;;OAMG;IACH,cAAc,CAAC,GAAgB,EAAG,EAAqD,EACvF,OAA8B,EAAC,eAAe,EAAE,IAAI,EAAC;QAEnD,IAAI,kBAAkB,GAAG,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,CAAC,KAAK,CAAC,EAAE,CAAC,CAAC;QACvD,OAAO,kBAAkB,CAAC,MAAM,GAAG,CAAC,EAAE;YACpC,IAAI,KAAK,GAAG,kBAAkB,CAAC,MAAM,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;YACtD,KAAK,IAAI,kBAAkB,CAAC,MAAM,KAAK,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC;YACrD,EAAE,CAAC,KAAK,EAAE,IAAI,CAAC,UAAU,CAAC,CAAC;SAC5B;QAED,IAAI,CAAC,eAAe,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,aAAa,EAAE,GAAG,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC;IAC9D,CAAC;CAEF;AApFD,gDAoFC","sourcesContent":["import { RequestType } from '../helpers';\r\nimport { EventEmitter } from 'events';\r\n\r\nimport { Timer } from './Timer';\r\nimport { fail } from '../helpers';\r\n\r\n\r\n/**\r\n * @param {boolean} emitRequestSent If set to true it will emit a `requestSent` event after completing a request process.\r\n */\r\nexport type ProcessRequestOptions = {\r\n  emitRequestSent: boolean\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/**\r\n * A class that manages a client connection for NotesManager service \r\n */\r\nexport class NotesManagerClient extends EventEmitter {\r\n  private timer: Timer;\r\n  private connection: EventEmitter;\r\n  /**\r\n   * \r\n   * @param {EventEmitter} connection Client connection\r\n   */\r\n  constructor(timeoutLimit: number = 2000) {\r\n    super();\r\n    this.timer = new Timer();\r\n    \r\n    /**\r\n     * Every time a request is sent, timer is started.\r\n     */\r\n    this.on('requestSent', (req) => {\r\n      this.timer.start(timeoutLimit);\r\n    })\r\n\r\n    /**\r\n     * Every time a response is received timer is stopped\r\n     */\r\n    this.on('response', () => {\r\n      this.timer.stop();\r\n    });\r\n\r\n    /**\r\n     * When timer timesout a `timeout` event is emitted\r\n     */\r\n    this.timer.on('timeout', () => {\r\n      this.emit('timeout', this.connection);\r\n    })\r\n\r\n    this.connect(new EventEmitter());\r\n  }\r\n\r\n\r\n  connect(newConnection: EventEmitter) {\r\n    this.connection = newConnection;\r\n    this.setHandlers(this.connection);\r\n  }\r\n\r\n  /**\r\n   * Sets handlers for current connection\r\n   */\r\n  setHandlers(connection: EventEmitter) {\r\n    // Error handler\r\n    connection.on('error', (err) => {\r\n      console.log(fail(`There has been an error: ${err.message}`));\r\n      process.exit(-1);\r\n    });\r\n\r\n    // Data handler (emits a 'response' event when a complete response has been received)\r\n    let incomingResponse = '';\r\n    connection.on('data', (chunk) => {\r\n      incomingResponse += chunk;\r\n\r\n      if (incomingResponse[incomingResponse.length - 1] === '\\n') {\r\n        this.emit('response', JSON.parse(incomingResponse));\r\n        incomingResponse = '';\r\n      }\r\n    });\r\n\r\n  }\r\n\r\n  /**\r\n   * It splits the request into 50 character chunks and the callback is executed passing\r\n   * each of those chunks and the client connection.\r\n   * @param {RequestType} request Request to send\r\n   * @param {(chunk: string, connection: EventEmitter) => void} cb Callback for each data chunk\r\n   * @param {ProcessRequestOptions} opts\r\n   */\r\n  processRequest(req: RequestType,  cb: (chunk: string, connection: EventEmitter) => void, \r\n  opts: ProcessRequestOptions = {emitRequestSent: true}) {\r\n\r\n    let stringifiedRequest = JSON.stringify(req).split('');\r\n    while (stringifiedRequest.length > 0) {\r\n      let chunk = stringifiedRequest.splice(0, 51).join('');\r\n      chunk += stringifiedRequest.length === 0 ? '\\n' : '';\r\n      cb(chunk, this.connection);\r\n    }\r\n\r\n    opts.emitRequestSent ? this.emit('requestSent', req) : true;\r\n  }\r\n  \r\n}\r\n\r\n\r\n\r\n\r\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"d1f02a2dbb5345e44189b6167bf060e15b1182a3","contentHash":"cc81942170554979d79381f7f6112bf9ab09d93aa1d6bfc0c315562dd56407f3"},"/mnt/c/Users/migue/Documents/U/3ero/DSI/p10/src/Client/Timer.ts":{"path":"/mnt/c/Users/migue/Documents/U/3ero/DSI/p10/src/Client/Timer.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":23}},"2":{"start":{"line":4,"column":17},"end":{"line":4,"column":34}},"3":{"start":{"line":7,"column":8},"end":{"line":7,"column":16}},"4":{"start":{"line":10,"column":8},"end":{"line":12,"column":19}},"5":{"start":{"line":11,"column":12},"end":{"line":11,"column":33}},"6":{"start":{"line":15,"column":8},"end":{"line":15,"column":33}},"7":{"start":{"line":18,"column":0},"end":{"line":18,"column":22}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":6,"column":4},"end":{"line":6,"column":5}},"loc":{"start":{"line":6,"column":18},"end":{"line":8,"column":5}},"line":6},"1":{"name":"(anonymous_1)","decl":{"start":{"line":9,"column":4},"end":{"line":9,"column":5}},"loc":{"start":{"line":9,"column":18},"end":{"line":13,"column":5}},"line":9},"2":{"name":"(anonymous_2)","decl":{"start":{"line":10,"column":32},"end":{"line":10,"column":33}},"loc":{"start":{"line":10,"column":38},"end":{"line":12,"column":9}},"line":10},"3":{"name":"(anonymous_3)","decl":{"start":{"line":14,"column":4},"end":{"line":14,"column":5}},"loc":{"start":{"line":14,"column":11},"end":{"line":16,"column":5}},"line":14}},"branchMap":{},"s":{"0":1,"1":1,"2":1,"3":3,"4":2,"5":2,"6":1,"7":1},"f":{"0":3,"1":2,"2":2,"3":1},"b":{},"inputSourceMap":{"version":3,"file":"/mnt/c/Users/migue/Documents/U/3ero/DSI/p10/src/Client/Timer.ts","sources":["/mnt/c/Users/migue/Documents/U/3ero/DSI/p10/src/Client/Timer.ts"],"names":[],"mappings":";;;AAAA,mCAAoC;AAGpC,MAAa,KAAM,SAAQ,qBAAY;IAGrC;QACE,KAAK,EAAE,CAAC;IACV,CAAC;IAED,KAAK,CAAC,MAAc;QAClB,IAAI,CAAC,KAAK,GAAG,UAAU,CAAC,GAAG,EAAE;YAC3B,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;QACvB,CAAC,EAAE,MAAM,CAAC,CAAC;IACb,CAAC;IAED,IAAI;QACF,YAAY,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;IAC3B,CAAC;CACF;AAhBD,sBAgBC","sourcesContent":["import {EventEmitter} from 'events';\r\n\r\n\r\nexport class Timer extends EventEmitter {\r\n  \r\n  private timer: NodeJS.Timeout;\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  start(timeMS: number) {\r\n    this.timer = setTimeout(() => {\r\n      this.emit('timeout');\r\n    }, timeMS);\r\n  }\r\n\r\n  stop() {\r\n    clearTimeout(this.timer);\r\n  }\r\n}"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"a71e7dfc24134353c96ade424c3dcaada1ad7c2d","contentHash":"b1c557ea94d3ae423aae16b1dc4e9827593fcbf12d2a9652665ac28b63bed2f8"},"/mnt/c/Users/migue/Documents/U/3ero/DSI/p10/src/helpers.ts":{"path":"/mnt/c/Users/migue/Documents/U/3ero/DSI/p10/src/helpers.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":55}},"2":{"start":{"line":4,"column":14},"end":{"line":4,"column":30}},"3":{"start":{"line":6,"column":0},"end":{"line":6,"column":28}},"4":{"start":{"line":7,"column":0},"end":{"line":7,"column":30}},"5":{"start":{"line":8,"column":0},"end":{"line":8,"column":25}}},"fnMap":{},"branchMap":{},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1},"f":{},"b":{},"inputSourceMap":{"version":3,"file":"/mnt/c/Users/migue/Documents/U/3ero/DSI/p10/src/helpers.ts","sources":["/mnt/c/Users/migue/Documents/U/3ero/DSI/p10/src/helpers.ts"],"names":[],"mappings":";;;AAAA,+BAA+B;AAqB/B,SAAS;AACI,QAAA,IAAI,GAAG,KAAK,CAAC,MAAM,CAAC;AACpB,QAAA,OAAO,GAAG,KAAK,CAAC,KAAK,CAAC;AACtB,QAAA,IAAI,GAAG,KAAK,CAAC,GAAG,CAAC","sourcesContent":["import * as chalk from 'chalk';\r\nimport { KnownColors } from './NotesManager/Interfaces/colored';\r\nimport { EditObj } from './NotesManager/Interfaces/edit-obj';\r\n\r\nexport type CommandType = 'add' | 'remove' | 'list' | 'edit' | 'read';\r\n\r\nexport type ResponseType = {\r\n  success: boolean,\r\n  output: any,\r\n};\r\n\r\nexport type RequestType = {\r\n  type: CommandType;\r\n  username: string,\r\n  title?: string,\r\n  body?: string,\r\n  color?: KnownColors,\r\n  params?: EditObj \r\n}\r\n\r\n\r\n// Colors\r\nexport const warn = chalk.yellow;\r\nexport const success = chalk.green;\r\nexport const fail = chalk.red;"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"3c7fd8c956e1254afb096bf4200e5da82bacf40e","contentHash":"d3b6bf0c95f37b97523751b2c03f51b08100f1c4eb3afd2cefecfab5fc7b77c0"}}